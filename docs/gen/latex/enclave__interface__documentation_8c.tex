\doxysection{code/enclave\+\_\+interface\+\_\+documentation.c File Reference}
\label{enclave__interface__documentation_8c}\index{code/enclave\_interface\_documentation.c@{code/enclave\_interface\_documentation.c}}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
sgx\+\_\+status\+\_\+t \textbf{ sgxsd\+\_\+ocall\+\_\+reply} (const sgxsd\+\_\+msg\+\_\+header\+\_\+t $\ast$reply\+\_\+header, const uint8\+\_\+t $\ast$reply\+\_\+data, size\+\_\+t reply\+\_\+data\+\_\+size, sgxsd\+\_\+msg\+\_\+tag\+\_\+t msg\+\_\+tag)
\begin{DoxyCompactList}\small\item\em The enclave uses this O\+C\+A\+LL to pass the result of the contact discovery to the service. \end{DoxyCompactList}\item 
sgx\+\_\+status\+\_\+t \textbf{ sgxsd\+\_\+enclave\+\_\+node\+\_\+init} (sgx\+\_\+enclave\+\_\+id\+\_\+t eid, sgx\+\_\+status\+\_\+t $\ast$retval, const sgxsd\+\_\+node\+\_\+init\+\_\+args\+\_\+t $\ast$p\+\_\+args)
\begin{DoxyCompactList}\small\item\em This E\+C\+A\+LL will initialize the enclave. \end{DoxyCompactList}\item 
sgx\+\_\+status\+\_\+t \textbf{ sgxsd\+\_\+enclave\+\_\+server\+\_\+start} (sgx\+\_\+enclave\+\_\+id\+\_\+t eid, sgx\+\_\+status\+\_\+t $\ast$retval, const sgxsd\+\_\+server\+\_\+init\+\_\+args\+\_\+t $\ast$p\+\_\+args, sgxsd\+\_\+server\+\_\+state\+\_\+handle\+\_\+t state\+\_\+handle)
\begin{DoxyCompactList}\small\item\em Used to start the server specified with state\+\_\+handle. \end{DoxyCompactList}\item 
sgx\+\_\+status\+\_\+t \textbf{ sgxsd\+\_\+enclave\+\_\+server\+\_\+call} (sgx\+\_\+enclave\+\_\+id\+\_\+t eid, sgx\+\_\+status\+\_\+t $\ast$retval, const sgxsd\+\_\+server\+\_\+handle\+\_\+call\+\_\+args\+\_\+t $\ast$p\+\_\+args, const sgxsd\+\_\+msg\+\_\+header\+\_\+t $\ast$msg\+\_\+header, const uint8\+\_\+t $\ast$msg\+\_\+data, size\+\_\+t msg\+\_\+size, sgxsd\+\_\+msg\+\_\+tag\+\_\+t msg\+\_\+tag, sgxsd\+\_\+server\+\_\+state\+\_\+handle\+\_\+t state\+\_\+handle)
\begin{DoxyCompactList}\small\item\em Used to make a server call. \end{DoxyCompactList}\item 
sgx\+\_\+status\+\_\+t \textbf{ sgxsd\+\_\+enclave\+\_\+get\+\_\+next\+\_\+report} (sgx\+\_\+enclave\+\_\+id\+\_\+t eid, sgx\+\_\+status\+\_\+t $\ast$retval, sgx\+\_\+target\+\_\+info\+\_\+t qe\+\_\+target\+\_\+info, sgx\+\_\+report\+\_\+t $\ast$p\+\_\+report)
\begin{DoxyCompactList}\small\item\em Used to get the enclave measurement. \end{DoxyCompactList}\item 
sgx\+\_\+status\+\_\+t \textbf{ sgxsd\+\_\+enclave\+\_\+set\+\_\+current\+\_\+quote} (sgx\+\_\+enclave\+\_\+id\+\_\+t eid, sgx\+\_\+status\+\_\+t $\ast$retval)
\begin{DoxyCompactList}\small\item\em This function sets the old keypair equal to the newly generated keypair during a sgxsd\+\_\+enclave\+\_\+get\+\_\+next\+\_\+report call. \end{DoxyCompactList}\item 
sgx\+\_\+status\+\_\+t \textbf{ sgxsd\+\_\+enclave\+\_\+negotiate\+\_\+request} (sgx\+\_\+enclave\+\_\+id\+\_\+t eid, sgx\+\_\+status\+\_\+t $\ast$retval, const sgxsd\+\_\+request\+\_\+negotiation\+\_\+request\+\_\+t $\ast$p\+\_\+request, sgxsd\+\_\+request\+\_\+negotiation\+\_\+response\+\_\+t $\ast$p\+\_\+response)
\begin{DoxyCompactList}\small\item\em Used to establish a shared secret using E\+C\+DH. \end{DoxyCompactList}\item 
sgx\+\_\+status\+\_\+t \textbf{ sgxsd\+\_\+enclave\+\_\+server\+\_\+stop} (sgx\+\_\+enclave\+\_\+id\+\_\+t eid, sgx\+\_\+status\+\_\+t $\ast$retval, const sgxsd\+\_\+server\+\_\+terminate\+\_\+args\+\_\+t $\ast$p\+\_\+args, sgxsd\+\_\+server\+\_\+state\+\_\+handle\+\_\+t state\+\_\+handle)
\begin{DoxyCompactList}\small\item\em This function will find the intersection between registered users and the discovery requests and stop the server. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Function Documentation}
\mbox{\label{enclave__interface__documentation_8c_ad9fc450c6ed7fa6adddc8820240107df}} 
\index{enclave\_interface\_documentation.c@{enclave\_interface\_documentation.c}!sgxsd\_enclave\_get\_next\_report@{sgxsd\_enclave\_get\_next\_report}}
\index{sgxsd\_enclave\_get\_next\_report@{sgxsd\_enclave\_get\_next\_report}!enclave\_interface\_documentation.c@{enclave\_interface\_documentation.c}}
\doxysubsubsection{sgxsd\_enclave\_get\_next\_report()}
{\footnotesize\ttfamily sgx\+\_\+status\+\_\+t sgxsd\+\_\+enclave\+\_\+get\+\_\+next\+\_\+report (\begin{DoxyParamCaption}\item[{sgx\+\_\+enclave\+\_\+id\+\_\+t}]{eid,  }\item[{sgx\+\_\+status\+\_\+t $\ast$}]{retval,  }\item[{sgx\+\_\+target\+\_\+info\+\_\+t}]{qe\+\_\+target\+\_\+info,  }\item[{sgx\+\_\+report\+\_\+t $\ast$}]{p\+\_\+report }\end{DoxyParamCaption})}



Used to get the enclave measurement. 


\begin{DoxyParams}{Parameters}
{\em qe\+\_\+target\+\_\+info} & Target info. \\
\hline
{\em p\+\_\+report} & Will contain the measurement after the function is finished. \\
\hline
\end{DoxyParams}
\mbox{\label{enclave__interface__documentation_8c_ad8be24c001bc1e50a91ef4ac46329ddd}} 
\index{enclave\_interface\_documentation.c@{enclave\_interface\_documentation.c}!sgxsd\_enclave\_negotiate\_request@{sgxsd\_enclave\_negotiate\_request}}
\index{sgxsd\_enclave\_negotiate\_request@{sgxsd\_enclave\_negotiate\_request}!enclave\_interface\_documentation.c@{enclave\_interface\_documentation.c}}
\doxysubsubsection{sgxsd\_enclave\_negotiate\_request()}
{\footnotesize\ttfamily sgx\+\_\+status\+\_\+t sgxsd\+\_\+enclave\+\_\+negotiate\+\_\+request (\begin{DoxyParamCaption}\item[{sgx\+\_\+enclave\+\_\+id\+\_\+t}]{eid,  }\item[{sgx\+\_\+status\+\_\+t $\ast$}]{retval,  }\item[{const sgxsd\+\_\+request\+\_\+negotiation\+\_\+request\+\_\+t $\ast$}]{p\+\_\+request,  }\item[{sgxsd\+\_\+request\+\_\+negotiation\+\_\+response\+\_\+t $\ast$}]{p\+\_\+response }\end{DoxyParamCaption})}



Used to establish a shared secret using E\+C\+DH. 

This function needs to be called before making a server call. It will register a pending request and set all fields in the response parameter. 
\begin{DoxyParams}{Parameters}
{\em p\+\_\+request} & Contains the client public key. \\
\hline
{\em p\+\_\+response} & Will contain the enclave\textquotesingle{}s 2 public keys when this call is finished. \\
\hline
\end{DoxyParams}
\mbox{\label{enclave__interface__documentation_8c_aa4ef5ed9761682ea9df8546b7ecc24a2}} 
\index{enclave\_interface\_documentation.c@{enclave\_interface\_documentation.c}!sgxsd\_enclave\_node\_init@{sgxsd\_enclave\_node\_init}}
\index{sgxsd\_enclave\_node\_init@{sgxsd\_enclave\_node\_init}!enclave\_interface\_documentation.c@{enclave\_interface\_documentation.c}}
\doxysubsubsection{sgxsd\_enclave\_node\_init()}
{\footnotesize\ttfamily sgx\+\_\+status\+\_\+t sgxsd\+\_\+enclave\+\_\+node\+\_\+init (\begin{DoxyParamCaption}\item[{sgx\+\_\+enclave\+\_\+id\+\_\+t}]{eid,  }\item[{sgx\+\_\+status\+\_\+t $\ast$}]{retval,  }\item[{const sgxsd\+\_\+node\+\_\+init\+\_\+args\+\_\+t $\ast$}]{p\+\_\+args }\end{DoxyParamCaption})}



This E\+C\+A\+LL will initialize the enclave. 

This function must be called first, before all other E\+C\+A\+L\+LS.~\newline
It can only be called once. Calling it more than once will result in an error.~\newline
It will perform the enclave setup.~\newline

\begin{DoxyParams}{Parameters}
{\em p\+\_\+args} & Used to calculate the size of the memory region used for storing client contact discovery requests. \\
\hline
\end{DoxyParams}
\mbox{\label{enclave__interface__documentation_8c_ac358a627010b7be454fdaa472bc48eae}} 
\index{enclave\_interface\_documentation.c@{enclave\_interface\_documentation.c}!sgxsd\_enclave\_server\_call@{sgxsd\_enclave\_server\_call}}
\index{sgxsd\_enclave\_server\_call@{sgxsd\_enclave\_server\_call}!enclave\_interface\_documentation.c@{enclave\_interface\_documentation.c}}
\doxysubsubsection{sgxsd\_enclave\_server\_call()}
{\footnotesize\ttfamily sgx\+\_\+status\+\_\+t sgxsd\+\_\+enclave\+\_\+server\+\_\+call (\begin{DoxyParamCaption}\item[{sgx\+\_\+enclave\+\_\+id\+\_\+t}]{eid,  }\item[{sgx\+\_\+status\+\_\+t $\ast$}]{retval,  }\item[{const sgxsd\+\_\+server\+\_\+handle\+\_\+call\+\_\+args\+\_\+t $\ast$}]{p\+\_\+args,  }\item[{const sgxsd\+\_\+msg\+\_\+header\+\_\+t $\ast$}]{msg\+\_\+header,  }\item[{const uint8\+\_\+t $\ast$}]{msg\+\_\+data,  }\item[{size\+\_\+t}]{msg\+\_\+size,  }\item[{sgxsd\+\_\+msg\+\_\+tag\+\_\+t}]{msg\+\_\+tag,  }\item[{sgxsd\+\_\+server\+\_\+state\+\_\+handle\+\_\+t}]{state\+\_\+handle }\end{DoxyParamCaption})}



Used to make a server call. 

This function can be used to send an encrypted contact discovery request to the server.~\newline
The message is decrypted and is stored behind previous messages in a byte array.~\newline
Message meta-\/data is stored in the server state in a linked list. 
\begin{DoxyParams}{Parameters}
{\em p\+\_\+args} & Contains the amount of contacts in the request. \\
\hline
{\em msg\+\_\+header} & Contains the IV and M\+AC used by the enclave for decrypting the request. \\
\hline
{\em msg\+\_\+data} & The encrypted message. \\
\hline
{\em msg\+\_\+size} & The encrypted message size. \\
\hline
{\em msg\+\_\+tag} & Used for indicating which client this request belongs to. \\
\hline
{\em state\+\_\+handle} & Used as index to fetch the appropriate server state. \\
\hline
\end{DoxyParams}
\mbox{\label{enclave__interface__documentation_8c_aca495acd15cdbfc6120b10ea4b12b45d}} 
\index{enclave\_interface\_documentation.c@{enclave\_interface\_documentation.c}!sgxsd\_enclave\_server\_start@{sgxsd\_enclave\_server\_start}}
\index{sgxsd\_enclave\_server\_start@{sgxsd\_enclave\_server\_start}!enclave\_interface\_documentation.c@{enclave\_interface\_documentation.c}}
\doxysubsubsection{sgxsd\_enclave\_server\_start()}
{\footnotesize\ttfamily sgx\+\_\+status\+\_\+t sgxsd\+\_\+enclave\+\_\+server\+\_\+start (\begin{DoxyParamCaption}\item[{sgx\+\_\+enclave\+\_\+id\+\_\+t}]{eid,  }\item[{sgx\+\_\+status\+\_\+t $\ast$}]{retval,  }\item[{const sgxsd\+\_\+server\+\_\+init\+\_\+args\+\_\+t $\ast$}]{p\+\_\+args,  }\item[{sgxsd\+\_\+server\+\_\+state\+\_\+handle\+\_\+t}]{state\+\_\+handle }\end{DoxyParamCaption})}



Used to start the server specified with state\+\_\+handle. 

This function starts the server specified with the state\+\_\+handle argument.~\newline
It can only be called once for each server.~\newline
Zeroes the region of memory corresponding to the server state, then initializes the server state.~\newline
Must be called once on a server before this server can be used to make calls. 
\begin{DoxyParams}{Parameters}
{\em p\+\_\+args} & Used to calculate size of server state. \\
\hline
{\em state\+\_\+handle} & Used as index to fetch the appropriate server state. Must be smaller than the max allowed amount of servers (256). \\
\hline
\end{DoxyParams}
\mbox{\label{enclave__interface__documentation_8c_ae01af3b5ebf55d64942471b57088c220}} 
\index{enclave\_interface\_documentation.c@{enclave\_interface\_documentation.c}!sgxsd\_enclave\_server\_stop@{sgxsd\_enclave\_server\_stop}}
\index{sgxsd\_enclave\_server\_stop@{sgxsd\_enclave\_server\_stop}!enclave\_interface\_documentation.c@{enclave\_interface\_documentation.c}}
\doxysubsubsection{sgxsd\_enclave\_server\_stop()}
{\footnotesize\ttfamily sgx\+\_\+status\+\_\+t sgxsd\+\_\+enclave\+\_\+server\+\_\+stop (\begin{DoxyParamCaption}\item[{sgx\+\_\+enclave\+\_\+id\+\_\+t}]{eid,  }\item[{sgx\+\_\+status\+\_\+t $\ast$}]{retval,  }\item[{const sgxsd\+\_\+server\+\_\+terminate\+\_\+args\+\_\+t $\ast$}]{p\+\_\+args,  }\item[{sgxsd\+\_\+server\+\_\+state\+\_\+handle\+\_\+t}]{state\+\_\+handle }\end{DoxyParamCaption})}



This function will find the intersection between registered users and the discovery requests and stop the server. 

This function will find the intersection between registered users and the discovery requests.~\newline
After that, the server is terminated.~\newline
It will call the O\+C\+A\+LL with the encrypted reply. 
\begin{DoxyParams}{Parameters}
{\em p\+\_\+args} & Contains the list of registered users. \\
\hline
{\em state\+\_\+handle} & Used to indentify the server that needs to be stopped. \\
\hline
\end{DoxyParams}
\mbox{\label{enclave__interface__documentation_8c_ac12b7ed1466840e11661314ca7cb3af0}} 
\index{enclave\_interface\_documentation.c@{enclave\_interface\_documentation.c}!sgxsd\_enclave\_set\_current\_quote@{sgxsd\_enclave\_set\_current\_quote}}
\index{sgxsd\_enclave\_set\_current\_quote@{sgxsd\_enclave\_set\_current\_quote}!enclave\_interface\_documentation.c@{enclave\_interface\_documentation.c}}
\doxysubsubsection{sgxsd\_enclave\_set\_current\_quote()}
{\footnotesize\ttfamily sgx\+\_\+status\+\_\+t sgxsd\+\_\+enclave\+\_\+set\+\_\+current\+\_\+quote (\begin{DoxyParamCaption}\item[{sgx\+\_\+enclave\+\_\+id\+\_\+t}]{eid,  }\item[{sgx\+\_\+status\+\_\+t $\ast$}]{retval }\end{DoxyParamCaption})}



This function sets the old keypair equal to the newly generated keypair during a sgxsd\+\_\+enclave\+\_\+get\+\_\+next\+\_\+report call. 

\mbox{\label{enclave__interface__documentation_8c_a3d19c87973f20a1681b1aba738157180}} 
\index{enclave\_interface\_documentation.c@{enclave\_interface\_documentation.c}!sgxsd\_ocall\_reply@{sgxsd\_ocall\_reply}}
\index{sgxsd\_ocall\_reply@{sgxsd\_ocall\_reply}!enclave\_interface\_documentation.c@{enclave\_interface\_documentation.c}}
\doxysubsubsection{sgxsd\_ocall\_reply()}
{\footnotesize\ttfamily sgx\+\_\+status\+\_\+t sgxsd\+\_\+ocall\+\_\+reply (\begin{DoxyParamCaption}\item[{const sgxsd\+\_\+msg\+\_\+header\+\_\+t $\ast$}]{reply\+\_\+header,  }\item[{const uint8\+\_\+t $\ast$}]{reply\+\_\+data,  }\item[{size\+\_\+t}]{reply\+\_\+data\+\_\+size,  }\item[{sgxsd\+\_\+msg\+\_\+tag\+\_\+t}]{msg\+\_\+tag }\end{DoxyParamCaption})}



The enclave uses this O\+C\+A\+LL to pass the result of the contact discovery to the service. 

This function will be called after a server is stopped using the sgxsd\+\_\+enclave\+\_\+server\+\_\+stop E\+C\+A\+LL.~\newline
The enclave will pass the result of the contact discovery requests to the service. ~\newline
The result consists of 1 byte for each contact that was in the request. This byte will be 1 in case the contact is a registered users, 0 in case the contact isn\textquotesingle{}t registered. 
\begin{DoxyParams}{Parameters}
{\em reply\+\_\+header} & Contains the IV and M\+AC used for decrypting the reply. \\
\hline
{\em reply\+\_\+data} & Contains a 0 byte for each contact in the request that is not registered and a 1 byte for each contact that is registered. \\
\hline
{\em reply\+\_\+data\+\_\+sise} & The size of the reply in bytes, 1 byte for earch contact in the request. \\
\hline
{\em msg\+\_\+tag} & Indicates to which client this reply should be sent. \\
\hline
\end{DoxyParams}
